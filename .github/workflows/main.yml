
name: CI (Secrets → Sonar → Maven)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  ci:
    runs-on: self-hosted   # or [self-hosted, linux, x64]

    steps:
      - name: Checkout (full history for scanners)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Java 17 (Temurin) + Maven cache
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          cache: maven

      - name: Install prerequisites for Sonar scanner
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip wget

      - name: Install Maven (apt)
        run: |
          sudo apt-get update
          sudo apt-get install -y maven
      # ---- If you prefer a pinned Maven, replace the above with:
      # - name: Set up Maven 3.9.8
      #   uses: s4u/setup-maven-action@v1
      #   with:
      #     maven-version: '3.9.8'

      - name: Gitleaks scan (fail on leaks)
        uses: gitleaks/gitleaks-action@v2
        # If you only want fail/no-fail, you can remove env:
        # env:
        #   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Build with tests so Sonar sees bytecode and test reports
